<!DOCTYPE html>
<html lang="en">
	<head>
		<% include partials/head %>

		<script>
		var counter = 1;

		function selectName(inputString, id){
			// Find the name in the actordropdown string and replace with 
			searchStr = "<option value='" + id + "'>";
			replaceStr = "<option value='" + id + "' selected>";
			var result = inputString.replace(searchStr, replaceStr);
			return result;
		}

		function addInput(divName){

			if(divName == 'dynamicRelationInput') {
				var newdiv = document.createElement('div');
          		newdiv.innerHTML = "<%= actor.name %> is related to <%- actordropdown %> as <input type='text' id='relTarget' name='relTarget[]'>";
          		document.getElementById(divName).appendChild(newdiv);
          	
			} else {
    	
        		var newdiv = document.createElement('div');
          		newdiv.innerHTML = "<input type='text' name='label'> <input type='text' name='value' length='5'>";
          		document.getElementById(divName).appendChild(newdiv);
          		counter++;
     		};
		}

		function addImage(file){
			
			//alert(JSON.stringify(file));
    		var newdiv = document.createElement('div');
      		newdiv.innerHTML = "<input type='hidden' name='imagepath' value='" + file.path + "'><img src='/" + file.path + "' height='150' width='150'><br>Filename: <input type='text' name='filename' value='" + file.originalname + "'><br>Comments: <input type='text' name='imagecomments'>";
      		document.getElementById('images').appendChild(newdiv);
		}

		Dropzone.options.uploadWidget = {
		  paramName: 'file',
		  maxFilesize: 2, // MB
		  maxFiles: 1,
		  dictDefaultMessage: 'Drag an image here to upload, or click to select one',
		  headers: {
		    'actor_id': '<%= actor._id %>',
		  },
		  acceptedFiles: 'image/*',
		  init: function() {
		    this.on('success', function( file, resp ){
		      console.log( file );
		      console.log( resp );
			  this.removeFile(file);
			  addImage(resp);
		    });
		    this.on('thumbnail', function(file) {
		      if ( file.width < 640 || file.height < 480 ) {
		        file.rejectDimensions();
		      }
		      else {
		        file.acceptDimensions();
		      }
		    });
		  },
		  accept: function(file, done) {
		    file.acceptDimensions = done;
		    file.rejectDimensions = function() {
		      done('The image must be at least 640 x 480px')
		    };
		  }
		};
	
		</script>
	</head>
	<body class="container">
		<header>
			<% include partials/header %>
		</header>
		
		<main>
			<div class="jumbotron">

			<div>
		 
           <% if(typeof(errorMessage) !== 'undefined') {%>
              <span><%= errorMessage %></span>
           <% } %>


		<form method="post" action="/actors/<%= actor._id %>">
		<input type="hidden" name="_method" value="put" />
		 
           <% if(typeof(errorMessage) !== 'undefined') {%>
              <span><%= errorMessage %></span>
           <% } %>
		 
           <div class="form-group">
		 	<% for (var key in actor) { %>
		 		<% if(key != '_id' && key != '') { %>
		 			<% if(key != 'actorTarget' && key != 'relTarget' && key != 'imagepath') { %>
		 				<label for="<%= key %>"><%= key %></label>
              			<input type="text" class="form-control" name="<%= key %>" length="5" id="<%= key %>" value="<%= actor[key] %>"/> <a href="/actors/remove/<%= actor._id %>/<%= key %>">X</a><br>
		 			<% } %>
		 		<% } %>
			<% } %>


			<hr>
			<p> Add new parameters
			<div id="dynamicInput">
          		<input type="text" id="label1" name="label"> <input type="text" id="value1" name="value" length="5"> 
     		</div>
     		<input type="button" value="+ parameter" onClick="addInput('dynamicInput');">


			<hr>
			<p> Images
			<% if(actor.imagepath) {%>
			<% actor.imagepath.forEach(function(el, index) { %>
			<p><input type='hidden' name='imagepath' value='<%= el %>'><img src='/<%= el %>' height='150' width='150'>
			<% }); %>
			<% } %>
			<hr>
			<div id="images">

			</div>

	          <p>
	             <button type="submit" name="submit" id="submit" class="btn btn-default">update</button>
	          </p>
			
			
	     </form>

		 <div id="imageupload">
		 <p>Upload an image to add</p>
<form id="upload-widget" method="post" action="/actors/upload" class="dropzone">
<input type="hidden" name="actor_id" value="<%= actor._id %>" />
</form>
		</div>

	     <a href='/actors/delete/<%= actor._id %>' class="btn btn-primary btn-lg" role="button">Delete This Actor</a>
		 	</main>
		
	<footer>
		<% include partials/footer %>
	</footer>
	</body>
</html>